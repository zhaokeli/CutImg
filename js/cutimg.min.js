!function(t,e){"use strick";function i(t){u&&void 0!==console&&("object"==typeof t?console.log(t):console.log("%c"+t,"color: #fff; background: #f40;padding:0px 10px; font-size: 14px;"))}function c(t){var e={};for(var i in t)e[i]="object"==typeof t[i]?c(t[i]):t[i];return e}function n(t,e){var i=new Image;return i.src=t,i.complete?void e.call(i):void(i.onload=function(){e.call(i)})}function o(){this.container=null,this.callback=null,this.img=null,this.con_w=0,this.con_h=0,this.img_s_w=0,this.img_s_h=0,this.img_c_w=0,this.img_c_h=0,this.cutRect=null,this.cutRectSize={left:0,top:0,width:100,height:100},this.rectScale=0,this.img_scale=1,this.cut_bg=null,this.cut_zz=null,this.cut_zz_img=null,this.ckMoveArea=null}var u=!0;o.prototype={isMobile:function(){var t=navigator.userAgent,e=t.match(/(iPad).*OS\s([\d_]+)/),i=!e&&t.match(/(iPhone\sOS)\s([\d_]+)/),c=t.match(/(Android)\s+([\d.]+)/);return i||c},initContainer:function(t){var i=this;if(i.container)return!1;i.container=e(t),i.con_w=i.container.outerWidth(),i.con_h=i.container.outerHeight(),i.container.append('<div  class="cutimg-container"><div class="ck-move-area"></div><div class="cut-black-bg"></div><div class="cutimg-bg"></div><div class="cutimg-zz"><div class="zz-img"></div><div class="move-point"><div class="move-block"></div><div class="point-t-l"></div><div class="point-t-c"></div><div class="point-t-r"></div><div class="point-b-l"></div><div class="point-b-c"></div><div class="point-b-r"></div><div class="point-l-c"></div><div class="point-r-c"></div></div></div></div>');var c={width:i.con_w,height:i.con_h};i.container.find(".cutimg-container").css(c),i.cutRect=i.container.find(".move-point"),i.cut_bg=i.container.find(".cutimg-bg"),i.cut_zz=i.container.find(".cutimg-zz"),i.cut_zz_img=i.cut_zz.find(".zz-img"),i.ckMoveArea=i.container.find(".ck-move-area")},setRectScale:function(t){this.rectScale=t},setRectSize:function(t){this.cutRectSize=t},addImage:function(t,e){var i=this;i.callback=e,n(t,function(){i.img=this,i.img_s_w=i.img.width,i.img_s_h=i.img.height,i._initImage(),i._initCutRect()})},_initImage:function(){var t=this,e='<img src="'+t.img.src+'" />';t.container.find(".cutimg-bg").html(t.img),t.container.find(".cutimg-zz .zz-img").html(e),t.container.find("img").attr({onselectstart:"return false",unselectable:"on"});var i=t.container.find("img"),c=t.img.width/t.img.height;t.img.width>t.img.height?t.img.width>t.con_w&&(i.width(t.con_w),i.height(t.con_w/c)):t.img.height>t.con_h&&(i.height(t.con_h),i.width(t.con_h*c)),t.img_c_w=t.img.width,t.img_c_h=t.img.height,t.img_scale=t.img_c_h/t.img_s_h,t._resetPosition(),setTimeout(function(){t._resetPosition()},500);var n={width:t.img_c_w,height:t.img_c_h};if(t.cut_bg.css(n),t.cut_zz.css(n),t.cut_zz_img.css(n),t.cutRectSize.width>t.img_c_w&&(t.cutRectSize.left=-1)&&(t.cutRectSize.width=t.img_c_w),t.cutRectSize.height>t.img_c_h&&(t.cutRectSize.top=-1)&&(t.cutRectSize.height=t.img_c_h),0!==t.rectScale)if(t.cutRectSize.width<t.cutRectSize.height){var o=parseInt(t.cutRectSize.width/t.rectScale);t.cutRectSize.height=o}else{var u=parseInt(t.cutRectSize.height*t.rectScale);t.cutRectSize.width=u}t._moveCutArea()},_resetPosition:function(){var t=this;i(t.img.offsetWidth);var e=t.img_c_w/2,c=t.img_c_h/2;t.cut_bg.css({marginLeft:-e,marginTop:-c}),t.cut_zz.css({marginLeft:-e,marginTop:-c})},_initCutRect:function(){var t=this,c=t.cutRect.find("div").not(".move-block");t.isMobile()?(c.each(function(t,c){var o=e(this)[0];o.addEventListener("touchstart",function(t){if(1==t.targetTouches.length){t.preventDefault();var c=t.targetTouches[0];n(e(this),c.pageX,c.pageY)}i(t)},!1)}),t.ckMoveArea[0].addEventListener("touchmove",function(e){if(1==e.targetTouches.length){e.preventDefault();var i=e.targetTouches[0];o(t.selectedObj,i.pageX,i.pageY)}},!1),t.ckMoveArea[0].addEventListener("touchend",function(e){if(e.changedTouches.length>0){e.preventDefault();var i=e.changedTouches[0];u(t.selectedObj,i.pageX,i.pageY)}},!1)):(c.mousedown(function(t){n(e(this),t.clientX,t.clientY)}),t.ckMoveArea.mousemove(function(e){o(t.selectedObj,e.clientX,e.clientY)}),t.ckMoveArea.mouseup(function(e){u(t.selectedObj,e.clientX,e.clientY)}),t.ckMoveArea.mouseout(function(e){u(t.selectedObj,e.clientX,e.clientY)}));var n=function(e,i,c){t.ck_mousedown=!0,t.s_point={x:i,y:c},t.selectedObj=e,t.ckMoveArea.css("cursor",e.css("cursor")),t.ckMoveArea.show()},o=function(e,c,n){t.ck_mousedown&&(t.timeid&&clearTimeout(t.timeid),t.timeid=setTimeout(function(){var o=e.prop("class");switch(i(o),o){case"point-t-l":t.upBorder(-(n-t.s_point.y)),t.leftBorder(-(c-t.s_point.x));break;case"point-t-c":t.upBorder(-(n-t.s_point.y));break;case"point-t-r":t.upBorder(-(n-t.s_point.y)),t.rightBorder(c-t.s_point.x);break;case"point-b-l":t.downBorder(n-t.s_point.y),t.leftBorder(-(c-t.s_point.x));break;case"point-b-c":t.downBorder(n-t.s_point.y);break;case"point-b-r":t.downBorder(n-t.s_point.y),t.rightBorder(c-t.s_point.x);break;case"point-l-c":t.leftBorder(-(c-t.s_point.x));break;case"point-r-c":t.rightBorder(c-t.s_point.x)}t.s_point={x:c,y:n}}))},u=function(e,c,n){t.selectedObj=null,t.timeid&&clearTimeout(t.timeid),t.ckMoveArea.hide(),i("ck_mouse up"),t.ck_mousedown&&t.successCallback(),t.ck_mousedown=!1};if(t.isMobile()){var s=t.cutRect.find(".move-block")[0];s.addEventListener("touchstart",function(t){if(1==t.targetTouches.length){t.preventDefault();var e=t.targetTouches[0];a(e.pageX,e.pageY)}i(t)},!1),s.addEventListener("touchmove",function(t){if(1==t.targetTouches.length){t.preventDefault();var e=t.targetTouches[0];r(e.pageX,e.pageY)}},!1),s.addEventListener("touchend",function(t){if(t.changedTouches.length>0){t.preventDefault();var e=t.changedTouches[0];h(e.pageX,e.pageY)}},!1)}else{var s=t.cutRect.find(".move-block");s.mousedown(function(t){a(t.clientX,t.clientY)}),s.mousemove(function(t){r(t.clientX,t.clientY)}),s.mouseup(function(t){h(t.clientX,t.clientY)}),s.mouseout(function(t){h(t.clientX,t.clientY)})}var a=function(e,i){t.mousedown=!0,t.s_point={x:e,y:i}},r=function(e,i){t.timeid&&clearTimeout(t.timeid),t.timeid=setTimeout(function(){t.mousedown&&(t.cutRectSize.left=t.cutRectSize.left+e-t.s_point.x,t.cutRectSize.top=t.cutRectSize.top+i-t.s_point.y,t.s_point={x:e,y:i},t._moveCutArea())})},h=function(e,i){t.timeid&&clearTimeout(t.timeid),t.mousedown&&t.successCallback(),t.mousedown=!1}},getCutPoint:function(){var t=this,e=Math.round((parseInt(t.cutRect.css("left"))+1)/t.img_scale),i=Math.round((parseInt(t.cutRect.css("top"))+1)/t.img_scale);return{x:e>t.img_s_w?t.img_s_w:e,y:i>t.img_s_h?t.img_s_h:i,width:t.cutRectSize.width,height:t.cutRectSize.height}},successCallback:function(){var t=this;"function"==typeof t.callback&&t.callback(t.getCutPoint())},_moveCutArea:function(){var t=this;if(!t._isRectInImage())return i("矩形区域有错"),i(t.cutRectSize),t.cutRectSize_bak&&(t.cutRectSize=c(t.cutRectSize_bak)),!1;t.cutRectSize_bak=c(t.cutRectSize),t.cutRect.css({left:t.cutRectSize.left,top:t.cutRectSize.top,width:t.cutRectSize.width,height:t.cutRectSize.height});var e={top:t.cutRectSize.top,right:t.cutRectSize.left+t.cutRectSize.width+1,bottom:t.cutRectSize.top+t.cutRectSize.height+1,left:t.cutRectSize.left+1};t.cut_zz_img.css({clip:"rect("+e.top+"px,"+e.right+"px,"+e.bottom+"px,"+e.left+"px)"})},_isRectInImage:function(){var t=this,e=t.cutRectSize.height+t.cutRectSize.top+1,i=t.cutRectSize.width+t.cutRectSize.left+1;return!(e>t.img_c_h||i>t.img_c_w||t.cutRectSize.top<-1||t.cutRectSize.left<-1)},upBorder:function(t){var e=this,i=e.cutRectSize.height+t,c=e.cutRectSize.top-t;i>e.img_c_h||50>i||-1>c||e._upDownMove(i,c,!0)},downBorder:function(t){var e=this,i=e.cutRectSize.height+t,c=i+e.cutRectSize.top+1;i>e.img_c_h||50>i||c>e.img_c_h||e._upDownMove(i,c)},_upDownMove:function(t,e,i){var c=this;if(0!==c.rectScale){var n=parseInt(t*c.rectScale);if(n>c.img_c_w)return;c.cutRectSize.height=t;var o=-1==c.cutRectSize.left,u=c.cutRectSize.left+c.cutRectSize.width+1==c.img_c_w;o&&u||!o&&!u?c.cutRectSize.left=c.cutRectSize.left-(n-c.cutRectSize.width)/2:u&&(c.cutRectSize.left=c.cutRectSize.left-(n-c.cutRectSize.width)),c.cutRectSize.width=n}else c.cutRectSize.height=t;i&&(c.cutRectSize.top=e),c._moveCutArea()},_leftRightMove:function(t,e,i){var c=this;if(0!==c.rectScale){var n=parseInt(t/c.rectScale);if(n>c.img_c_h)return;c.cutRectSize.width=t;var o=-1==c.cutRectSize.top,u=c.cutRectSize.top+c.cutRectSize.height+1==c.img_c_h;u&&o||!u&&!o?c.cutRectSize.top=c.cutRectSize.top-(n-c.cutRectSize.height)/2:u&&(c.cutRectSize.top=c.cutRectSize.top-(n-c.cutRectSize.height)),c.cutRectSize.height=n}else c.cutRectSize.width=t;i&&(c.cutRectSize.left=e),c._moveCutArea()},leftBorder:function(t){var e=this,i=e.cutRectSize.width+t,c=e.cutRectSize.left-t;i>e.img_c_w||50>i||-1>c||e._leftRightMove(i,c,!0)},rightBorder:function(t){var e=this,i=e.cutRectSize.width+t,c=i+e.cutRectSize.left+1;i>e.img_c_w||50>i||c>e.img_c_w||e._leftRightMove(i,c)}},t.CutImg=function(t){return new o(t)}}(window,$);